apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: idsidsmember-node
  namespace: ids-bes
  annotations:
    flux.weave.works/automated: "false"
spec:
  releaseName: idsidsmember-node
  interval: 1m
  chart:
   spec:
    chart: platforms/hyperledger-besu/charts/node_besu
    sourceRef:
      kind: GitRepository
      name: flux-prod
      namespace: flux-prod
  values:
    metadata:
      namespace: ids-bes
      labels:
    replicaCount: 1
    staticnodes:
      - "enode://ba8b811dba519fc238dcd767e53d11c96438dd942ffc3ab59151c0ee0d1ab6e186ddc4ac7c0e98016c61f7a124d025754b87b99e77a43e23ae2be97fe1df477f@validator1.app.bharatblockchain.io:15010"
      - "enode://3bbec8ac3ed32ab264c488876e65e0dfbc0771b73b2c09d902d84e6943576ed4c73daa305f1a1725d8e294ca161e89a86b355c0898238e7ba970d9ded18bb010@validator2.app.bharatblockchain.io:15012"
      - "enode://65463c0c5925c4d9a647f39f4c4ac97a630e7ce4a16bc26e40e8d914450e00473f8f0baac777e63ec24576b737d671afb41610604d6adc06335908b8dd6c4233@validator3.app.bharatblockchain.io:15014"
      - "enode://9520736e137a5abe93f15bd2c439ccfb895f13ce7c39b73dd2b1fbcb876f2bd4e8efcfe738decd13412d0a12a2dba491c4e9ffa6af32fd6e29cc05a2e52fb485@validator4.app.bharatblockchain.io:15016"
      - "enode://16f528100f1c7d6e894a0fc851c15f7c5ba94d42dc7a7d8a3d8cec12074d5f7acdad5b95846d29ca2fd947c72ae35263442cd05e030145dc2883e0df52d5f5c9@ids.app.bharatblockchain.io:15020"

    liveliness_check:
      enabled: false
    healthcheck:
      readinessthreshold: 100
      readinesscheckinterval: 5
    proxy:
      provider: ambassador
      external_url: ids.app.bharatblockchain.io
      p2p: 15020
      rpc: 15021

    images:
      node: hyperledger/besu:21.10.6
      alpineutils: index.docker.io/hyperledgerlabs/alpine-utils:1.0
      pullPolicy: IfNotPresent

    node:
      name: ids
      consensus: ibft
      subject: O=Carrier,OU=Carrier,L=51.50/-0.13/London,C=GB
      mountPath: /opt/besu/data
      servicetype: ClusterIP
      imagePullSecret: regcred
      ports:
        p2p: 30303
        rpc: 8545
        ws: 8546

    tm:
      type: tessera
      tls: True
      url: "https://ids-tessera.ids-bes:8888"

    storage:
      storageclassname: awsstorageclass
      storagesize: 1Gi

    vault:
      address: http://afaa81f5113c849ca8e7cad72f262df9-2626065.ap-south-1.elb.amazonaws.com:8200
      secretprefix: secretsv2/data/ids-bes/crypto/ids
      serviceaccountname: vault-auth
      keyname: data
      tmdir: tm
      tlsdir: tls
      role: vault-role
      authpath: besuids

    genesis: ewogICJjb25maWciOiB7CiAgICAiY2hhaW5JZCI6IDIwMjMsCiAgICAiY29uc3RhbnRpbm9wbGVmaXhibG9jayI6IDAsCiAgICAiY29udHJhY3RTaXplTGltaXQiOiAyMTQ3NDgzNjQ3LAogICAgImliZnQyIjogewogICAgICAiYmxvY2twZXJpb2RzZWNvbmRzIjogMiwKICAgICAgImVwb2NobGVuZ3RoIjogMzAwMDAsCiAgICAgICJyZXF1ZXN0dGltZW91dHNlY29uZHMiOiAxMCwKICAgICAgImJsb2NrcmV3YXJkIjogIjUwMDAwMDAwMDAwMDAwMDAiLAogICAgICAibWluaW5nYmVuZWZpY2lhcnkiOiAiMHhhNzU3ODNFN2E0OTJmOWVEOWM1MmIzMWM2QTYxQURGZEY2MkE4NDExIgogICAgfQogIH0sCiAgIm5vbmNlIjogIjB4MCIsCiAgInRpbWVzdGFtcCI6ICIweDU4ZWU0MGJhIiwKICAiZXh0cmFEYXRhIjogIjB4Zjg3ZWEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMGY4NTQ5NDhlOWU3ZTEyZTJlNWE2Y2ZkZGUxZDZhMTNiMGMwMDI5NzY5YmUyNWU5NDI2Zjc2MGVjZGE4YTE1ZTViNmI3MWQ4OWExMjZmYTg4ZGJmZTg3NTc5NDIyMjU5ZGYxYTNjYThlNjk0NDhiMTdlZTdkMGE3ODNkMDJlNmE2NDc5NDFmYmQ0ZDM4ZDA5MjNmY2FhNzQ4OWIwMTliYTJjOGM1Njk1ZjFmMjE4MDg0MDAwMDAwMDBjMCIsCiAgImdhc0xpbWl0IjogIjB4MWZmZmZmZmZmZmZmZmYiLAogICJkaWZmaWN1bHR5IjogIjB4MSIsCiAgIm1peEhhc2giOiAiMHg2Mzc0Njk2MzYxNmMyMDYyNzk3YTYxNmU3NDY5NmU2NTIwNjY2MTc1NmM3NDIwNzQ2ZjZjNjU3MjYxNmU2MzY1IiwKICAiY29pbmJhc2UiOiAiMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwIiwKICAiYWxsb2MiOiB7CiAgICAiYTc1NzgzRTdhNDkyZjllRDljNTJiMzFjNkE2MUFERmRGNjJBODQxMSI6IHsKICAgICAgImJhbGFuY2UiOiAiMHhhZDc4ZWJjNWFjNjIwMDAwMCIKICAgIH0sCiAgICAiNzUwM2E3OTRBNTk4MTcyNkVDMjdEMjZGMjI0N0RjMjYxZTc2NjM0NCI6IHsKICAgICAgImJhbGFuY2UiOiAiOTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAiCiAgICB9LAogICAgIjU5MDAxQUVGRUZDRDcyQWMyNUNGYjM1RTAwQmFlZmM4NDhhQmRGODYiOiB7CiAgICAgICJiYWxhbmNlIjogIjkwMDAwMDAwMDAwMDAwMDAwMDAwMDAwIgogICAgfQogIH0KfQ==
